define(["jquery","core/notification","core/form-autocomplete","tool_lp/dialogue","core/str"],function(a,b,c,d,e){var f=function(){var d=this;a('input[name="allocationview"]').on("change",d.switchView.bind(d)),a(".allocation-see-results").on("click",d.renderAllocationResults.bind(d)),a(".manual-allocation-see-results").on("click",d.showAffectedParticipants.bind(d)),a(".allocation-buttons a").on("click",d.renderAllocation.bind(d)),a("select[name=by], select[name=of]").on("change",function(b){b.preventDefault(),window.onbeforeunload=null,a(b.target).parents("form:first").submit()}),a(document).ready(function(){e.get_strings([{key:"addreviewer",component:"workshopallocation_manual"},{key:"addreviewee",component:"workshopallocation_manual"}]).done(function(b){a(".addreviewer").each(function(){c.enhance("#"+a(this).attr("id"),!1,!1,b[0])}),a(".addreviewee").each(function(){c.enhance("#"+a(this).attr("id"),!1,!1,b[1])})}).fail(b.exception)})};return f.prototype.allocationDialogue={},f.prototype.allocationResultsDialogue=null,f.prototype.affectedParticipantsDialogue=null,f.prototype.showAllocationForm=function(b){var c=this,d=a(b.getContent()),e=a('input[name="allocationview"]:checked').val(),f="reviewee"==e?1:2;d.find("fieldset.hidden").removeClass("hidden"),d.find('select[name="numper"]').val(f),d.find(".btn-cancel").on("click",function(a){a.preventDefault(),c.hideDialogue(b)})},f.prototype.renderAllocation=function(b){var c=this,e=a(b.target),f=e.data("method");if(c.allocationDialogue[f])c.showDialogue(c.allocationDialogue[f]);else{var g=a(".allocator-"+f);c.allocationDialogue[f]=new d(e.data("title"),g.html(),c.showAllocationForm.bind(c)),g.remove()}},f.prototype.renderAllocationResults=function(){var c=this;e.get_strings([{key:"allocationresults",component:"workshopallocation_random"}]).done(function(b){if(c.allocationResultsDialogue)c.showDialogue(c.allocationResultsDialogue);else{var e=a(".allocation-results-container");c.allocationResultsDialogue=new d(b[0],e.html()),e.remove()}}).fail(b.exception)},f.prototype.switchView=function(){var b=a('input[name="allocationview"]:checked').val();"reviewee"==b?(a(".allocations .reviewerof").hide(),a(".allocations .reviewedby").show(),M.util.set_user_preference("workshopallocation_manual_view","reviewedby")):(a(".allocations .reviewedby").hide(),a(".allocations .reviewerof").show(),M.util.set_user_preference("workshopallocation_manual_view","reviewerof"))},f.prototype.showAffectedParticipants=function(){var c=this;e.get_strings([{key:"affectedparticipants",component:"workshopallocation_manual"}]).done(function(b){if(c.affectedParticipantsDialogue)c.showDialogue(c.affectedParticipantsDialogue);else{var e=a(".allocation-popup-content");c.affectedParticipantsDialogue=new d(b[0],e.html(),function(){},function(){},(!0)),e.remove()}}).fail(b.exception)},f.prototype.showDialogue=function(a){a.yuiDialogue.show()},f.prototype.hideDialogue=function(a){a.yuiDialogue.hide()},{init:function(){new f}}});